//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: com/igormaznitsa/prol/io/ProlTextOutputStream.java
//
//  Created by katsura on 14/04/13.
//

#include "IOSClass.h"
#include "com/igormaznitsa/prol/data/NumericTerm.h"
#include "com/igormaznitsa/prol/data/Term.h"
#include "com/igormaznitsa/prol/io/ProlStreamManager.h"
#include "com/igormaznitsa/prol/io/ProlTextOutputStream.h"
#include "com/igormaznitsa/prol/logic/ProlContext.h"
#include "java/io/IOException.h"
#include "java/io/Writer.h"
#include "java/lang/NullPointerException.h"

@implementation ComIgormaznitsaProlIoProlTextOutputStream

- (id)initWithJavaIoWriter:(JavaIoWriter *)writer
withComIgormaznitsaProlLogicProlContext:(ComIgormaznitsaProlLogicProlContext *)context
               withBoolean:(BOOL)forAppend {
  if (self = [super init]) {
    self->resourceId_ = @".local";
    self->context_ = context;
    self->writer_ = writer;
    thisTerm_ = [[ComIgormaznitsaProlDataTerm alloc] initWithNSString:resourceId_];
  }
  return self;
}

- (id)initWithNSString:(NSString *)resourceId
withComIgormaznitsaProlLogicProlContext:(ComIgormaznitsaProlLogicProlContext *)context
           withBoolean:(BOOL)forAppend {
  if (self = [super init]) {
    if (resourceId == nil) {
      @throw [[JavaLangNullPointerException alloc] initWithNSString:@"Resource id must not be null"];
    }
    self->resourceId_ = resourceId;
    self->context_ = context;
    writer_ = [((id<ComIgormaznitsaProlIoProlStreamManager>) nil_chk([((ComIgormaznitsaProlLogicProlContext *) nil_chk(context)) getStreamManager])) getWriterForResourceWithNSString:resourceId withBoolean:forAppend];
    if (writer_ == nil) {
      @throw [[JavaIoIOException alloc] initWithNSString:[NSString stringWithFormat:@"Can't open resource '%@' for writting", resourceId]];
    }
    thisTerm_ = [[ComIgormaznitsaProlDataTerm alloc] initWithNSString:resourceId];
  }
  return self;
}

- (ComIgormaznitsaProlLogicProlContext *)getContext {
  return context_;
}

- (JavaIoWriter *)getWriter {
  @synchronized(self) {
    {
      return writer_;
    }
  }
}

- (NSString *)getResourceId {
  return resourceId_;
}

- (void)writeTermWithComIgormaznitsaProlDataTerm:(ComIgormaznitsaProlDataTerm *)term {
  @synchronized(self) {
    {
      [((JavaIoWriter *) nil_chk(writer_)) writeWithNSString:[((ComIgormaznitsaProlDataTerm *) nil_chk(term)) forWrite]];
      [writer_ flush];
    }
  }
}

- (void)writeCharWithComIgormaznitsaProlDataTerm:(ComIgormaznitsaProlDataTerm *)term {
  @synchronized(self) {
    {
      unichar charToWrite = 0;
      if ([term conformsToProtocol: @protocol(ComIgormaznitsaProlDataNumericTerm)]) {
        charToWrite = (unichar) [((NSNumber *) nil_chk([((id<ComIgormaznitsaProlDataNumericTerm>) nil_chk(((id<ComIgormaznitsaProlDataNumericTerm>) check_protocol_cast(term, @protocol(ComIgormaznitsaProlDataNumericTerm))))) getNumericValue])) intValue];
      }
      else {
        NSString *text = [((ComIgormaznitsaProlDataTerm *) nil_chk(term)) getText];
        if (text != nil) {
          charToWrite = [text charAtWithInt:0];
        }
      }
      [((JavaIoWriter *) nil_chk(writer_)) writeWithInt:charToWrite];
      [writer_ flush];
    }
  }
}

- (ComIgormaznitsaProlDataTerm *)getAsTerm {
  return thisTerm_;
}

- (void)close {
  @synchronized(self) {
    {
      [((JavaIoWriter *) nil_chk(writer_)) close];
    }
  }
}

- (void)copyAllFieldsTo:(ComIgormaznitsaProlIoProlTextOutputStream *)other {
  [super copyAllFieldsTo:other];
  other->context_ = context_;
  other->resourceId_ = resourceId_;
  other->thisTerm_ = thisTerm_;
  other->writer_ = writer_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "initWithJavaIoWriter:withComIgormaznitsaProlLogicProlContext:withBoolean:", "ProlTextOutputStream", NULL, 0x4, "Ljava.io.IOException;" },
    { "initWithNSString:withComIgormaznitsaProlLogicProlContext:withBoolean:", "ProlTextOutputStream", NULL, 0x1, "Ljava.io.IOException;" },
    { "getContext", NULL, "Lcom.igormaznitsa.prol.logic.ProlContext;", 0x1, NULL },
    { "getWriter", NULL, "Ljava.io.Writer;", 0x21, NULL },
    { "getResourceId", NULL, "Ljava.lang.String;", 0x1, NULL },
    { "writeTermWithComIgormaznitsaProlDataTerm:", "writeTerm", "V", 0x21, "Ljava.io.IOException;" },
    { "writeCharWithComIgormaznitsaProlDataTerm:", "writeChar", "V", 0x21, "Ljava.io.IOException;" },
    { "getAsTerm", NULL, "Lcom.igormaznitsa.prol.data.Term;", 0x1, NULL },
    { "close", NULL, "V", 0x21, "Ljava.io.IOException;" },
  };
  static J2ObjcFieldInfo fields[] = {
    { "resourceId_", NULL, 0x12, "Ljava.lang.String;" },
    { "writer_", NULL, 0x12, "Ljava.io.Writer;" },
    { "context_", NULL, 0x12, "Lcom.igormaznitsa.prol.logic.ProlContext;" },
    { "thisTerm_", NULL, 0x12, "Lcom.igormaznitsa.prol.data.Term;" },
  };
  static J2ObjcClassInfo _ComIgormaznitsaProlIoProlTextOutputStream = { "ProlTextOutputStream", "com.igormaznitsa.prol.io", NULL, 0x1, 9, methods, 4, fields, 0, NULL};
  return &_ComIgormaznitsaProlIoProlTextOutputStream;
}

@end
